<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>고속도로 정보 시스템</title>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
        #map {
            width: 100%;
            height: 100%;
        }
        /* 고속도로 선택 메뉴 스타일 */
        .highway-selector {
            position: absolute; /* 지도 위에 겹치도록 설정 */
            top: 10px;
            right: 10px;
            background-color: white;
            padding: 10px;
            border-radius: 5px;
            z-index: 1000; /* 다른 요소들보다 위에 보이도록 설정 */
            border: 1px solid #ccc;
        }
    </style>
</head>
<body>
    <div class="highway-selector">
        <h3>고속도로 선택</h3>
        <input type="checkbox" id="toggle-all" name="highway-toggle">
        <label for="toggle-all"><b>전체 선택</b></label>
        <hr>
        <input type="checkbox" id="gyeongbu" name="highway" value="gyeongbu">
        <label for="gyeongbu">경부선</label><br>
        <input type="checkbox" id="yeongdong" name="highway" value="yeongdong">
        <label for="yeongdong">영동선</label><br>
        <input type="checkbox" id="seohaean" name="highway" value="seohaean">
        <label for="seohaean">서해안선</label><br>
        <input type="checkbox" id="jungbu" name="highway" value="jungbu">
        <label for="jungbu">중부선</label><br>
        <input type="checkbox" id="honam" name="highway" value="honam">
        <label for="honam">호남선</label><br>
    </div>

    <div id="map"></div>
<script>
    // 1. 'map'이라는 id를 가진 div에 지도를 생성합니다.
    var map = L.map('map').setView([36.8, 127.5], 7); // 지도의 중심점을 한반도 중심으로 조정

    // 2. 지도에 표시될 배경 타일 레이어를 추가합니다.
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    // 3. (대폭 확장) 전국의 주요 고속도로 가상 경로 데이터
    // 각 고속도로의 이름, 색상, 경로 데이터를 객체 형태로 정리하여 관리하기 쉽게 변경
    // (대폭 상세화) 모든 고속도로의 경로 데이터를 세밀하게 추가
        const highwayData = {
            gyeongbu: {
                name: '경부선', color: 'blue',
                path: [[37.5665, 126.9780],[37.5172, 127.0473],[37.4764, 127.0494],[37.3328, 127.0982],[37.2800, 127.0100],[37.2200, 127.0000],[37.0083, 127.0678],[36.8143, 127.1468],[36.6343, 127.4941],[36.3214, 127.4201],[36.1365, 127.5830],[35.9431, 127.9113],[35.8814, 128.4014],[35.8714, 128.6014],[35.5689, 128.9958],[35.5390, 129.0900],[35.4328, 129.2478],[35.2384, 129.0769],[35.1796, 129.0756]]
            },
            yeongdong: {
                name: '영동선', color: 'green',
                path: [[37.4563, 126.7052],[37.4000, 126.8500],[37.3300, 127.0500],[37.2958, 127.3200],[37.3333, 127.6000],[37.3800, 127.9833],[37.5000, 128.3000],[37.6000, 128.6000],[37.7519, 128.8761]]
            },
            seohaean: {
                name: '서해안선', color: '#E69900',
                path: [[37.5700, 126.8800],[37.3900, 126.8000],[37.2750, 126.7052],[36.9500, 126.7500],[36.8143, 126.7000],[36.5000, 126.5500],[36.2500, 126.6500],[35.9078, 126.6900],[35.4800, 126.5300],[34.8118, 126.3900]]
            },
            jungbu: {
                name: '중부선', color: 'red',
                path: [[37.7300, 127.0490],[37.6000, 127.1500],[37.5200, 127.2200],[37.3500, 127.2800],[37.1500, 127.3500],[37.0083, 127.4000],[36.8000, 127.4500],[36.6343, 127.4941]]
            },
            honam: {
                name: '호남선', color: 'purple',
                path: [[36.3214, 127.4201],[36.2000, 127.2000],[36.0000, 127.0500],[35.8200, 127.1480],[35.6000, 126.9500],[35.3000, 126.8800],[35.1600, 126.8510]]
            }
        };

    // 4. 지도에 그려진 라인을 저장할 객체
    const highwayLayers = {};

    // 5. HTML 요소들을 변수에 저장
    const highwayCheckboxes = document.querySelectorAll('input[name="highway"]');
    const toggleAllCheckbox = document.getElementById('toggle-all');

    // 6. '전체 선택' 체크박스 이벤트 처리 (버그 수정한 최종본)
    toggleAllCheckbox.addEventListener('change', function() {
        const isChecked = this.checked;
        highwayCheckboxes.forEach(checkbox => {
            checkbox.checked = isChecked;
            // 이벤트 발생 대신, 함수를 직접 호출하여 충돌 방지
            toggleHighway(checkbox.value, isChecked);
        });
    });

    // 개별 고속도로 체크박스 이벤트 처리
    highwayCheckboxes.forEach(checkbox => {
        checkbox.addEventListener('change', function() {
            toggleHighway(this.value, this.checked);
            updateToggleAllCheckboxState();
        });
    });
    
    // 지도에 라인을 그리거나 지우는 핵심 함수
    function toggleHighway(highwayName, isChecked) {
        if (isChecked) {
            if (!highwayLayers[highwayName]) {
                const data = highwayData[highwayName];
                const polyline = L.polyline(data.path, { color: data.color }).addTo(map);
                polyline.bindPopup(`<b>${data.name}</b>`);
                highwayLayers[highwayName] = polyline;
            }
        } else {
            if (highwayLayers[highwayName]) {
                map.removeLayer(highwayLayers[highwayName]);
                delete highwayLayers[highwayName];
            }
        }
    }

    // '전체 선택' 체크박스의 상태를 업데이트하는 함수
    function updateToggleAllCheckboxState() {
        const allChecked = Array.from(highwayCheckboxes).every(cb => cb.checked);
        const someChecked = Array.from(highwayCheckboxes).some(cb => cb.checked);

        if (allChecked) {
            toggleAllCheckbox.checked = true;
            toggleAllCheckbox.indeterminate = false;
        } else if (someChecked) {
            toggleAllCheckbox.checked = false;
            toggleAllCheckbox.indeterminate = true; // 일부만 선택 시 '-' 표시
        } else {
            toggleAllCheckbox.checked = false;
            toggleAllCheckbox.indeterminate = false;
        }
    }
    // 페이지 로드 시 초기 상태 확인
    updateToggleAllCheckboxState();
</script>

    </script>
</body>
</html>